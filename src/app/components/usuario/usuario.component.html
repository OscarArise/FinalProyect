@if (!loginUsuario) {
  <div class="container">
    <!-- Formulario de Login -->
    <div class="formulario" *ngIf="!mostrarRegistro">
      <form>
        <div class="form-group">
          <label for="usuario" class="text-oro">Nombre de Usuario</label>
          <input type="text" name="username" [(ngModel)]="usuario.username" />
        </div>

        <div class="form-group">
          <label for="password" class="text-oro">Contraseña</label>
          <input type="password" name="password" [(ngModel)]="usuario.password" />
        </div>

        <!-- Aquí agregamos el reCAPTCHA -->
        <re-captcha [siteKey]="siteKey" (resolved)="resolvedCaptcha($event)"></re-captcha>

        <button type="button" class="btn-enviar" (click)="login()">Enviar</button>
      </form>

      <!-- Enlace para mostrar el formulario de registro -->
      <p class="text-oro">¿No tienes cuenta? <a href="javascript:void(0)" (click)="mostrarRegistro = true">Regístrate aquí</a></p>
    </div>

    <hr />

    <!-- Formulario de Registro de Usuario -->
    <div class="formulario" *ngIf="mostrarRegistro">
      <form>
        <h2 class="text-oro">Registro de nuevo usuario</h2>

        <div class="form-group">
          <label for="nombreCompleto" class="text-oro">Nombre completo</label>
          <input type="text" name="nombreCompleto" [(ngModel)]="nuevoUsuario.nombre" required />
        </div>

        <div class="form-group">
          <label for="nuevoEmail" class="text-oro">Correo electrónico</label>
          <input type="email" name="nuevoEmail" [(ngModel)]="nuevoUsuario.email" required />
        </div>

        <div class="form-group">
          <label for="nuevoPassword" class="text-oro">Contraseña</label>
          <input type="password" name="nuevoPassword" [(ngModel)]="nuevoUsuario.password" required />
        </div>

        <div class="form-group">
          <label for="confirmarPassword" class="text-oro">Confirmar contraseña</label>
          <input type="password" name="confirmarPassword" [(ngModel)]="nuevoUsuario.confirmarPassword" required />
        </div>

        <!-- Aquí agregamos el reCAPTCHA para el registro -->
        <re-captcha [siteKey]="siteKey" (resolved)="resolvedCaptcha($event)"></re-captcha>

        <button type="button" class="btn-enviar" (click)="registrar()">Registrar</button>

        <!-- Enlace para volver al login -->
        <p class="text-oro">¿Ya tienes cuenta? <a href="javascript:void(0)" (click)="mostrarRegistro = false">Inicia sesión aquí</a></p>
      </form>
    </div>
  </div>

  @if (bloqueado) {
    <!-- Formulario de Restablecer Contraseña -->
    <div class="container">
      <div class="formulario">
        <h2 class="text-oro">Restablecer contraseña</h2>
        <form>
          <div class="form-group">
            <label for="resetEmail" class="text-oro">Correo electrónico</label>
            <input type="email" name="resetEmail" [(ngModel)]="resetForm.email" required />
          </div>
          <button type="button" class="btn-enviar" (click)="cambiarPassword()">Enviar correo de restablecimiento</button>
        </form>
        <p class="text-blanco">Recibirás un correo con instrucciones para cambiar tu contraseña.</p>
      </div>
    </div>
  }
} @else {
  <div class="container">
    <div class="formulario">
      <h1 class="text-oro">Bienvenido {{ usuario.username }}</h1>
      <button type="button" class="btn-enviar" (click)="logout()">Cerrar Sesión</button>
    </div>
  </div>

  @if (mensajesContacto.length > 0) {
    <div class="tabla-container">
      <h2 class="titulo-seccion">Mensajes de Contacto</h2>
      <div class="tabla-scroll">
        <table class="tabla-oro">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Email</th>
              <th>Asunto</th>
              <th>Mensaje</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for(mensaje of mensajesContacto; track mensaje; let j = $index) {
              @if(editandoContacto === j) {
                <tr>
                  <td><input [(ngModel)]="contactoEditado.nombre" /></td>
                  <td><input [(ngModel)]="contactoEditado.email" /></td>
                  <td><input [(ngModel)]="contactoEditado.asunto" /></td>
                  <td><input [(ngModel)]="contactoEditado.mensaje" /></td>
                  <td>
                    <button (click)="guardarContacto(j)" class="btn-enviar">Guardar</button>
                    <button (click)="cancelarEdicionContacto()" class="btn-cancelar">Cancelar</button>
                  </td>
                </tr>
              } @else {
                <tr>
                  <td>{{mensaje.nombre}}</td>
                  <td>{{mensaje.email}}</td>
                  <td>{{mensaje.asunto}}</td>
                  <td>{{mensaje.mensaje}}</td>
                  <td>
                    <button (click)="editarContacto(j)" class="btn-editar">Editar</button>
                    <button (click)="eliminarContacto(j)" class="btn-eliminar">Eliminar</button>
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>
    </div>
  } @else {
    <div class="mensaje">
      <p class="text-blanco">No hay mensajes de contacto.</p>
    </div>
  }

  @if (suscripciones.length > 0) {
    <div class="tabla-container">
      <h2 class="titulo-seccion">Suscripciones</h2>
      <div class="tabla-scroll">
        <table class="tabla-oro">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Teléfono</th>
              <th>Clase</th>
              <th>Fecha</th>
              <th>Publicidad</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for(suscripcion of suscripciones; track suscripcion; let i = $index) {
              @if(editandoSuscripcion === i) {
                <tr>
                  <td><input [(ngModel)]="suscripcionEditada.nombre" /></td>
                  <td><input [(ngModel)]="suscripcionEditada.telefono" /></td>
                  <td><input [(ngModel)]="suscripcionEditada.claseSeleccionada" /></td>
                  <td><input [(ngModel)]="suscripcionEditada.fecha" type="date" /></td>
                  <td>
                    <input type="checkbox" [(ngModel)]="suscripcionEditada.publicidad" />
                  </td>
                  <td>
                    <button (click)="guardarSuscripcion(i)" class="btn-enviar">Guardar</button>
                    <button (click)="cancelarEdicionSuscripcion()" class="btn-cancelar">Cancelar</button>
                  </td>
                </tr>
              } @else {
                <tr>
                  <td>{{suscripcion.nombre}}</td>
                  <td>{{suscripcion.telefono}}</td>
                  <td>{{suscripcion.claseSeleccionada}}</td>
                  <td>{{suscripcion.fecha}}</td>
                  <td>{{suscripcion.publicidad ? 'Sí' : 'No'}}</td>
                  <td>
                    <button (click)="editarSuscripcion(i)" class="btn-editar">Editar</button>
                    <button (click)="eliminarSuscripcion(i)" class="btn-eliminar">Eliminar</button>
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>
    </div>
  } @else {
    <div class="mensaje">
      <p class="text-blanco">No hay suscripciones.</p>
    </div>
  }
}